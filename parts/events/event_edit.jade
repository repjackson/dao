template(name='event_edit')
    with current_doc
        .ui.stackable.padded.grid
            .centered.middle.aligned.row 
                .sixteeen.wide.column
                    a.ui.icon.green.circular.button(href="/m/event/#{_id}/view" title='save' class=currentUser.invert_class)
                        i.checkmark.big.icon
                    .ui.inline.header 
                        +icolor name='tear-off-calendar'
                        |edit event
                    +boolean_edit key='published' label='published' direct=true
                    .ui.icon.basic.circular.button.delete_item(title='delete')
                        i.remove.red.icon
            .row
                .sixteen.wide.column
                    +session_edit_value_button key='event_edit_section' value='tribe' label='tribe' icon='campfire'
                    +session_edit_value_button key='event_edit_section' value='audience' label='audience' icon='groups'
                    +session_edit_value_button key='event_edit_section' value='room' label='room' icon='meeting-room'
                    +session_edit_value_button key='event_edit_section' value='people' label='people' icon='people'
                    +session_edit_value_button key='event_edit_section' value='info' label='info' icon='info'
                    if session_key_value_is 'event_edit_section' 'info'
                        +text_edit key='title' label='title' direct=true
                        // +slug_edit key='slug' label='slug' icon='slug' direct=true
                        // if reservation_exists
                        //     .ui.header date: #{date}
                        //     .ui.header time: #{time}
                        // else
                        .ui.header 
                            small author
                            |#{_author.name}
                        +boolean_edit key='has_description' label='description' direct=true
                        if has_description
                            +html_edit key='description' label='description' direct=true
                        +boolean_edit key='has_image' label='image' direct=true
                        if has_image
                            +image_edit key='image_id' label='image' direct=true
            
                        +date_edit key='date' label='date' direct=true
                        // +time_edit key='time' label='time' direct=true
                        +datetime_edit key='start_datetime' label='start date/time' direct=true
                        +number_edit key='hour_duration' label='hours' direct=true
                        // +range_edit label='time range' direct=true
                    if session_key_value_is 'event_edit_section' 'tribe'
                        with tribe 
                            +tribe_card_small
                        a.ui.header(href="/tribe/#{tribe_id}/view") tribe
                            |#{tribe_id}
                        +single_doc_edit ref_model='tribe' key='tribe_id' direct=true
                    
                    if session_key_value_is 'event_edit_section' 'people'
                        +single_user_edit key='facilitator_id' label='facilitator' icon='chess king' direct=true
                        +single_user_edit key='support_id' label='support' icon='chess queen' direct=true
                        div 
                        +smart_tagger
                        // +array_edit key='tags' label='tags' icon='red tags' direct=true
                    if session_key_value_is 'event_edit_section' 'audience'
                        .ui.header
                            i.users.icon
                            |audience
                        +number_edit key='max_attendees' label='max attendees' min='0' max='100' direct=true
                        div
                        +boolean_edit key='free' label='free' direct=true
                        unless free
                            +number_edit key='point_price' label='minimum points per ticket' min='0' max='100' direct=true
                    if session_key_value_is 'event_edit_section' 'room'
                        .ui.segment
                            .ui.inline.header room
                            each rooms 
                                .ui.circular.button.select_room(class=room_button_class)
                                    img.ui.mini.rounded.inline.image(src="{{c.url image_id height=500 width=500 gravity='face' crop='fill'}}")
                                    .ui.small.inline.header #{title}
                                    if dollars_per_hour
                                        | $#{dollars_per_hour}/hr
                            if room_id
                                unless key_value_is 'room_title' 'other'
                                    with event_room
                                        // .ui.header #{title}
                                        // |$#{dollars_per_hour}
                                        .ui.small.header schedule for #{current_doc.date}
                                    .ui.header slot 1: 9am-11am
                                    +reserve_button slot=1
                                    .ui.header slot 2: 11am-1pm
                                    +reserve_button slot=2
                                    .ui.header slot 3: 1pm-3pm  
                                    +reserve_button slot=3
                                    .ui.header slot 4: 3pm-5pm   
                                    +reserve_button slot=4
                                else
                                    +text_edit key='location' label='location' icon='red marker' direct=true
                                    +array_edit key='location_tags' label='location tags' icon='red tags' direct=true
                                    
                                    +datetime_edit key='start_datetime' label='start' direct=true
                                    // +datetime_edit key='end_datetime' label='end' direct=true
                             each room_reservations
                                .ui.header reserved


template(name='reserve_button')
    if slot_res
        .ui.segment
            with slot_res
                .ui.header 
                    |reserved by #{_author.name}
                if can_edit
                    .ui.circular.icon.button.cancel_res
                        i.red.remove.icon
    else 
        // if event_room.dollars_per_hour
        //     .ui.green.button.buy_slot buy slot #{slot}
        //     .ui.green.button.request_slot request for points
        // else
        .ui.green.button.reserve_slot reserve slot #{slot}
