template(name='tribe_view')
    with current_doc
        .ui.stackable.padded.grid
            .centered.row
                .four.wide.column
                    // if can_edit
                    a(href="/m/tribe" title='tribes')
                        i.circular.large.fire.link.icon
                    .ui.center.aligned.inline.header 
                        small viewing 
                        |#{title}
                        if private
                            i.lock.icon(title='private')
                        small tribe
                    if can_edit
                        a.edit_tribe(href="/m/tribe/#{_id}/edit")
                            i.big.pencil.circular.link.icon
                    +vote
                .eight.wide.column
                    .ui.big.accordion
                        .active.title
                            .ui.grey.inline.header 
                                i.rss.icon 
                                |#{latest_updates.count} latest
                            i.dropdown.icon
                        .active.content.smallscroll
                            .ui.feed
                                each latest_updates
                                    .event
                                        .label 
                                            img.ui.avatar.image(src="{{c.url _author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                                        .content
                                            .summary
                                                a.user(href="/user/#{_author_username}") #{_author_username}
                                                if image_id
                                                    img.ui.mini.rounded.inline.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                                                a(href="/m/#{model}/#{_id}/view") #{title} #{price}
                                                each tags 
                                                    .ui.label #{this}
                                            .meta 
                                                i.clock.icon 
                                                |#{when}
                                                +voting_small
                                            if key_value_is 'model' 'debit'
                                                i.large.gift.icon
                                                |#{seller.username}
                                            else if key_value_is 'model' 'post'
                                                i.large.newspaper.icon
                                            else
                                                .ui.label #{model}
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.newspaper.icon
                                |#{tribe_posts.count}
                                |posts
                            i.dropdown.icon
                        .content
                            .ui.icon.circular.button.add_tribe_post
                                i.plus.icon
                            .ui.link.large.selection.list
                                each tribe_posts
                                    a.item(href="/post/#{_id}/view") #{title}
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.info.icon
                                |info
                            i.dropdown.icon
                        .content
                            .ui.header
                                i.marker.icon 
                                |#{location}
                            +textarea_view key='description' label='description' direct=true
                            +array_view key='tags' label='tags' direct=true
                            +array_view key='location_tags' label='location tags' direct=true
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.shop.icon
                                |offers
                            i.dropdown.icon
                        .content
                            each latest_offers
                                a(href="/m/offer/#{_id}/view")
                                    img.ui.small.inline.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.concierge.bell.icon
                                |requests
                            i.dropdown.icon
                        .content
                            each latest_requests
                                a(href="/m/request/#{_id}/view")
                                    img.ui.small.inline.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.picture.icon
                                |pictures
                            each latest_photos
                                img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                            i.dropdown.icon
                        .content
                            each latest_photos
                                img.ui.small.inline.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.chat.icon
                                |comments
                            i.dropdown.icon
                        .content
                            +comments
                        .ui.divider
                        .title
                            .ui.inline.header 
                                i.coins.icon
                                |credits
                            i.dropdown.icon
                        .content
                            +tribe_finance
                        +tribe_badges
                    //- +array_view key='location_tags' label='location_tags' direct=true
                .four.wide.column
                    +image_view key='image_id' label='image' direct=true
                    .ui.button.add_tribe_gift
                        i.large.gift.icon
                        |gift
                    .ui.button.add_tribe_post
                        i.newspaper.large.icon
                        |post
                    .ui.button
                        i.picture.icon
                        |add image
                    .ui.button
                        i.concierge.bell.icon
                        |request
                    +multi_user_view key='leader_ids' label='leaders' icon='chess king' direct=true
                    +multi_user_view key='member_ids' label='members' icon='users' direct=true



template(name='tribe_badges')
    .title
        .ui.inline.header 
            i.certificate.icon
            |#{badges.count} badges
        each badges
            img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}")
        i.dropdown.icon
    .content
        if user_id_in 'leader_ids'
            i.large.plus.circular.link.icon.add_badge
        .ui.cards
            each badges
                a.ui.card(href="/m/badge/#{_id}/view") 
                    img.ui.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}")
                    .content
                        .header #{title}
template(name='tribe_finance')