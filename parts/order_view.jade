template(name='user_order_card')                    
    .ui.card
        .content
            .ui.header 
                i.receipt.icon
                |order
        if image_id
            a(href="/offer/#{order_offer._id}/view")
                img.ui.zoom.image(src="{{c.url order_offer.image_id height=100 width=200}}")
        .content.zoom.pointer
            a.header(href="/offer/#{order_offer._id}/view")
                |#{purchase_price}c #{order_offer.title}
            // |!{description}
            if complete 
                |completed by #{completer.name}
                +datetime_view key='delivery_datetime' label='delivery time' direct=true
                // +textarea_view key='delivery_location' label='delivery location' direct=true
                +textarea_view key='notes' label='notes' direct=true
                .spacer
                // .ui.large.label
                //     |tiffen type: #{tiffen_type}
        .content
            unless submitted
                if can_edit
                    .ui.green.fluid.button.submit_order
                        |submit order
            else
                .ui.fluid.button.unsubmit_order
                    i.undo.icon
                    |unsubmit order
            .ui.header delivery 
            if can_edit
                +boolean_edit key='delivery_started' direct=true
                if delivery_started
                    div
                    +boolean_edit key='delivery_complete' direct=true
                    if delivery_complete
                        +image_edit key='delivery_image' direct=true
                    
                        .ui.header customer
                        +boolean_edit key='delivery_accepted' label='delivery accepted' direct=true



template(name='order_view')
    with current_doc
        .ui.stackable.padded.grid
            .row 
                .five.wide.column
                    a.ui.zoom.pointer.fluid.card(href="/offer/#{offer_id}/view")
                        .content
                            .ui.inline.header
                                i.chevron.left.icon
                                |offer
                        img.ui.rounded.fluid.image(src="{{c.url order_offer.image_id height=200 width=200 gravity='face' crop='fill'}}")
                        .content
                            .ui.header
                                |#{order_offer.title}
                    if can_edit
                        .ui.basic.fluid.large.button.cancel_order
                            i.remove.red.icon
                            |cancel
                    a.ui.pointer.zoom.card(href="/user/#{_author.username}")
                        .content
                            .ui.inline.header 
                                i.user.outline.icon
                                |buyer
                            .ui.inline.header
                                img.ui.avatar.image(src="{{c.url _author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}")
                                |#{_author.username}
                            
                    +textarea_view key='description' label='description' direct=true
                    // +image_view key='image_id' label='image' direct=true
                    div 
                    if tags
                        i.tags.icon
                        each tags 
                            .ui.big.label #{this}
                    .spacer
                    .spacer
                    +comments
                    // +voting_full
                    //- +array_view key='location_tags' label='location_tags' direct=true
                .five.wide.column
                    .ui.inline.header
                        |#{price} credits 
                    |purchased
                    .ui.inline.header
                        | #{when}
                    .ui.small.header 
                        |{{fixed tax}}c tax
                    unless submitted
                        +key_value_edit key='transfer' value='pickup' icon='hands large'
                        +key_value_edit key='transfer' value='delivery' icon='truck large'
                    else
                        .ui.header transfer: #{transfer}
                    if key_value_is 'transfer' 'pickup'
                        unless submitted
                            +datetime_edit key='pickup_datetime' label='pickup date time' direct=true
                            +textarea_edit key='notes' label='notes' direct=true
                    if key_value_is 'transfer' 'delivery'
                        unless submitted
                            +datetime_edit key='delivery_datetime' label='delivery date time' direct=true
                            +textarea_edit key='notes' label='notes (location, instructions)' direct=true
                            // +key_value_edit key='tiffen_type' value='meat' direct=true
                            // +key_value_edit key='tiffen_type' value='veggie' direct=true
                            // .spacer
                            // .spacer
                            // +key_value_edit key='transfer' value='pickup' label='pickup' direct=true                    
                            // +key_value_edit key='transfer' value='delivery' label='delivery' direct=true                    
                            // if key_value_is key='transfer' value='delivery' direct=true
                            // +date_edit key='delivery_date' label='delivery date' direct=true
                            // +textarea_edit key='delivery_location' label='delivery location' direct=true
                            // +textarea_edit key='delivery_notes' label='delivery notes' direct=true
                        else
                            +datetime_view key='delivery_datetime' label='delivery time' direct=true
                            // +textarea_view key='delivery_location' label='delivery location' direct=true
                            +textarea_view key='notes' label='notes' direct=true
                            .spacer
                            // .ui.large.label
                            //     |tiffen type: #{tiffen_type}
                .six.wide.column
                    unless submitted
                        .ui.green.fluid.button.submit_order
                            |submit order
                    else
                        .ui.fluid.button.unsubmit_order
                            i.undo.icon
                            |unsubmit order
                    .ui.header delivery 
                    +boolean_edit key='delivery_started' direct=true
                    if delivery_started
                        div
                        +boolean_edit key='delivery_complete' direct=true
                        if delivery_complete
                            +image_edit key='delivery_image' direct=true
                            .ui.header customer
                            +boolean_edit key='delivery_accepted' label='delivery accepted' direct=true