template(name='home')
    .ui.stackable.padded.grid
        .row 
            // if is_admin
            //     .ui.big.button.check_notifications
            //         |check
            //     .ui.big.button.send_notification
            //         |send
                
            .sixteen.wide.column.toggle_finance_details
                .ui.green.small.progress.bar.pointer
                    .bar
                    // .label
                    //     |monthly budget progress / 20k
                if viewing_finance_details
                    .ui.stackable.grid
                        .two.column.row
                            .column
                                .ui.header finance details
                                .ui.header income from events
                            .column
                                .ui.header most generative event
                                .ui.header most generative member
                    
        .centered.row
            .sixteen.wide.center.aligned.column
                each members 
                    if profile_image_id
                        a(href="/user/#{username}" title="{{name}} {{points}}")
                            img.ui.tiny.pointer.inline.circular.spaced_image.zoom.image(src="{{c.url profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class)
        .centered.row
            .sixteen.wide.center.aligned.column
               .ui.basic.big.compact.circular.button.debit
                    i.gift.red.icon
                    |send points
                    // else
                    //     .ui.green.disabled.compact.circular.button
                    //         +icolor name='debit' cl='ui mini inline image'
                    //         // i.debit.icon
                    //         |send
                .ui.basic.big.compact.circular.button.request
                    i.concierge.bell.teal.icon
                    |request
                .ui.basic.big.compact.circular.button.offer
                    i.hand.holding.heart.olive.icon
                    |offer
                .ui.basic.big.compact.circular.button.add_bug
                    i.bug.red.icon
                    |+ bug
                .ui.basic.big.compact.circular.button.add_message
                    i.chat.blue.icon
                    |+ message
                if is_admin
                    a.ui.basic.big.button(href='/register')
                        i.user.plus.green.icon
                        |member

       
        // .centered.row
        //     .four.wide.column
                // if can_debit
            // .four.wide.column
            //     // if can_debit
            //     .ui.fluid.teal.button.request
            //         // i.hand.holding.heart.icon
            //         +icolor name='compass' cl='ui mini inline image'
            //         |add explorer
                // else
                //     .ui.fluid.teal.disabled.button
                //         // i.hand.holding.heart.icon
                //         +icolor name='request-service' cl='ui mini inline image'
                //         |request
            // .two.wide.column
            //     // .ui.center.aligned.grey.header.refresh_stats
            //     //     i.line.chart.icon
            //     //     |stats
            //     with stats_doc
            //         .ui.list
            //             .item #{total_points} system points
                        
        .row
            // .four.wide.column
            //     .ui.center.aligned.header
            //         // i.shop.icon
            //         +icolor name='shop' cl='ui image'
            //         |featured products
            //     // if is_admin 
            //     //     i.plus.icon.add_shift
            //     .medscroll
            //         each featured_products
            //             a.ui.fluid.card(href="/product/#{_id}/view")
            //                 .image
            //                     img.ui.image(src="{{c.url image_id height=200 width=500 crop='fill'}}")
            //                 .content
            //                     .header
            //                         |#{title}
            //                     .description
            //                         // if _author.profile_image_id
            //                         //     img.ui.avatar.image(src="{{c.url _author.profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
            //                         // | #{_author_username}
            //                         // div
            //                         .ui.inline.header $#{usd_price}
            //                         .ui.inline.header #{point_price}
            //                     // .meta #{when}
            //                     // .description 
            //                     //     |#{description}
            //                     // each tags 
            //                     //     .ui.tiny.basic.label #{this}
            // .four.wide.column
            //     .ui.center.aligned.header
            //         // i.clock.icon
            //         +icolor name='clock' cl='ui image'
            //         |next shifts
            //     // if is_admin 
            //     //     i.plus.icon.add_shift
            //     .medscroll
            //         each next_shifts
                            +home_shift_card
            .four.wide.column
                // a.ui.center.aligned.header(href="/events")
                .ui.center.aligned.header
                    i.calendar.orange.icon
                    |next events
                // if is_admin 
                //     i.plus.icon.add_event
                    
                .smallscroll
                    each next_events
                        +home_event_card
            .four.wide.column
                // a.ui.center.aligned.header(href="/m/debit")
                .ui.center.aligned.header
                    i.gift.red.icon
                    |gifts
                .smallscroll
                    each latest_debits
                        +debit_card
            .four.wide.column
                // a.ui.center.aligned.header(href="/requests")
                .ui.center.aligned.header
                    i.concierge.bell.teal.icon
                    |requests
                .smallscroll
                    each latest_requests
                        +home_request_card
                                            
            .four.wide.column
                // a.ui.center.aligned.header(href="/m/post")
                .ui.center.aligned.header
                    i.newspaper.icon
                    |news
                .ui.large.link.selection.list.smallscroll
                    each latest_posts
                        a.item(href="/m/post/#{_id}/view")
                            .header #{title}
                
                // .medscroll
                    // each latest_debits
                    //     a.ui.card(href="/debit/#{_id}/view")
                    //         .content
                    //             .description 
                    //                 if _author.profile_image_id
                    //                     img.ui.avatar.image(src="{{c.url _author.profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
                    //                 | #{_author_username}
                    //                 .ui.inline.header >
                    //                 if recipient.profile_image_id
                    //                     img.ui.avatar.image(src="{{c.url recipient.profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
                    //                 |#{recipient.username}
                    //                 .ui.inline.header #{amount}p
                    //             .meta #{when}
                    //             .description 
                    //                 |#{description}
                    //             each tags 
                    //                 .ui.tiny.basic.label #{this}
                                    
                                    
template(name='home_request_card')
    .ui.segment.view_request.pointer
        .content
            if youtube_id
                +youtube_view key='youtube_id' direct=true
            else if image_id
                img.ui.raw.image(src="{{c.url image_id width=400 height=300 crop='fill'}}")    

            .header
                .ui.inline.header #{point_bounty}p: #{title}
                if _author.profile_image_id
                    with _author
                        img.ui.avatar.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class title=shortname)
                | #{_author.name}
            |!{description}
            .meta #{when}
            // each tags 
            //     .ui.tiny.basic.label #{this}
            if doc_comments.count
                .meta
                    each doc_comments 
                        i.grey.chat.outline.icon
                        img.ui.avatar.image(src="{{c.url _author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class)
                        |#{body}
                        div


                                    
                                    
template(name='home_event_card')
    a.ui.fluid.card(href="/event/#{_id}/view")
        img.ui.image(src="{{c.url image_id height=200 width=500 crop='fill'}}")
        .content
            .header
                | #{title} 
            .meta    
                |{{home_long_date start_datetime}}
                .ui.small.grey.inline.header {{from_now start_datetime}}
            
            .meta    
                .ui.inline.small.header $#{usd_price} / #{point_price}p
                if _author.profile_image_id
                    with _author
                        img.ui.avatar.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class title=shortname)
                | #{_author.shortname}
            // .meta #{when}
            .description 
            if location
                i.marker.icon 
                |#{location}
            div 
        .content
            |#{going_user_ids.length}
            i.checkmark.green.large.icon
            each going
                img.ui.avatar.image(src="{{c.url profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class title=shortname)
            // i.question.orange.large.icon
            // | #{maybe_user_ids.length}
            // each maybe_going
            //     img.ui.avatar.image(src="{{c.url profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class title=shortname)
            // | #{not_user_ids.length}
            // i.remove.red.large.icon
            // each not_going
            //     img.ui.avatar.image(src="{{c.url profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class title=shortname)
            if doc_comments.count
                .meta
                    each doc_comments 
                        i.grey.chat.outline.icon
                        img.ui.avatar.image(src="{{c.url _author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class)
                        |#{body}
                        div
           
                               
                               
                               
                                    
template(name='debit_card')
    .ui.card.pointer.view_debit
        if image_id
            img.ui.image(src="{{c.url image_id height=200 width=500 crop='fill'}}")

        .content
            .description 
                if _author.profile_image_id
                    with _author
                        img.ui.avatar.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
                | #{_author.shortname}
                .ui.inline.header >
                if recipient.profile_image_id
                    with recipient
                        img.ui.avatar.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
                |#{recipient.shortname}
                .ui.inline.header #{amount}p
            .meta #{when}
            .description.f11
                |#{description}
            .spacer
            each tags 
                .ui.small.basic.label #{this}
            +voting_tiny
            if doc_comments.count
                .meta
                    each doc_comments 
                        i.grey.chat.outline.icon
                        img.ui.avatar.image(src="{{c.url _author.profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class)
                        |#{body}
                        div
                                    
template(name='join_button')
    .ui.fluid.green.button.join
        i.checkmark.icon
        |join




template(name='home_shift_card')
    a.ui.card(href="/shift/#{_id}/view")
        .content
            .header
                .ui.inline.header
                // if _author.profile_image_id
                //     img.ui.avatar.image(src="{{c.url _author.profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
                // | #{_author_username}
                .item from {{from_now start_datetime}} > {{from_now end_datetime}}
                if shift_contributors 
                    each shift_contributors
                        img.ui.avatar.image(src="{{c.url profile_image_id height=500 width=500 gravity='face' crop='fill'}}" class=user_class)
                        |#{username}
            .meta #{when}
            .description 
                |#{description}
            each tags 
                .ui.tiny.basic.label #{this}
